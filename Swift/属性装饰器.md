# å±æ€§è£…é¥°å™¨

å‚è€ƒï¼š  
- [https://mecid.github.io/](https://mecid.github.io/)
- [https://www.cnblogs.com/xiaoniuzai/p/11417123.html](https://www.cnblogs.com/xiaoniuzai/p/11417123.html)

### @State

é€šè¿‡ä½¿ç”¨ @State ä¿®é¥°å™¨æˆ‘ä»¬å¯ä»¥å…³è”å‡º View çš„çŠ¶æ€. SwiftUI å°†ä¼šæŠŠä½¿ç”¨è¿‡ @State ä¿®é¥°å™¨çš„å±æ€§å­˜å‚¨åˆ°ä¸€ä¸ªç‰¹æ®Šçš„å†…å­˜åŒºåŸŸï¼Œå¹¶ä¸”è¿™ä¸ªåŒºåŸŸå’Œ View struct æ˜¯éš”ç¦»çš„. å½“ @State è£…é¥°è¿‡çš„å±æ€§å‘ç”Ÿäº†å˜åŒ–ï¼ŒSwiftUI ä¼šæ ¹æ®æ–°çš„å±æ€§å€¼é‡æ–°åˆ›å»ºè§†å›¾

ç¤ºä¾‹ï¼š

```swift
struct LandmarkList: View {
    @State private var open: Bool = false
    var body: some View {
        Button(action: {
            self.open.toggle() // toggle()ä¼šè®©openå˜é‡çš„å€¼å–å
            if self.open {
                print("open")
            } else {
                print("close")
            }
        }, label: {
            Text("Click me")
        })
    }
}
```

### @Binding

Swiftä¸­è§†å›¾ä¹‹é—´å±æ€§çš„ä¼ é€’æ˜¯å€¼ç±»å‹ä¼ é€’ï¼Œé€šè¿‡@Bindingä¿®é¥°å™¨ä¿®é¥°åï¼Œå±æ€§å˜æˆäº†ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œä½¿ç”¨$å˜é‡åä¼ å€¼ï¼Œå±æ€§å‘ç”Ÿå˜åŒ–ä¼šè®©å­è§†å›¾åˆ·æ–°

```swift
if let windowScene = scene as? UIWindowScene {
    let window = UIWindow(windowScene: windowScene)
    window.rootViewController = UIHostingController(rootView: LandmarkList())
    self.window = window
    window.makeKeyAndVisible()
}
```

```swift
struct FilterView: View {
    @Binding var showFavorited: Bool

    var body: some View {
        Toggle(isOn: $showFavorited) {
            if showFavorited {
                Text("ğŸ˜Š")
            } else {
                Text("ğŸ˜‚")
            }
        }
    }
}

struct LandmarkList: View {
    @State private var open: Bool = false
    
    var body: some View {
        VStack {
            // æŠŠå±æ€§openä¼ ç»™å­è§†å›¾èŠ‚ç‚¹
            // è¿™é‡Œä½¿ç”¨$openæŠŠå¼•ç”¨ä¼ ç»™å­è§†å›¾ä½¿ç”¨@Bindingä¿®é¥°çš„showFavorite
            // è¿™æ ·çˆ¶å­è§†å›¾çš„çŠ¶æ€å°±å…³è”èµ·æ¥äº†ï¼Œå½“opençš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå­è§†å›¾çš„showFavoriteä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¼šè®©å­è§†å›¾é‡åˆ·é¡µé¢
            FilterView(showFavorited: $open)
            Button(action: {
                self.open.toggle()
            }, label: {
                Text("Click me")
            })
        }
    }
}
```

**æ³¨** ï¼šåœ¨ FilterView è§†å›¾é‡Œï¼ŒToggle ç»„ä»¶çš„åˆ›å»ºä¹Ÿä½¿ç”¨ `$showFavorited` è¿™ç§æ ¼å¼ï¼Œå› ä¸º Toggle ç»„ä»¶ä¼šä¿®æ”¹ä¼ å…¥çš„å€¼ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªçº¯è¯»çš„ç»„ä»¶æ¯”å¦‚ Text å°±ä¸éœ€è¦ ä½¿ç”¨ $showFavoritedï¼Œ ç›´æ¥ Text(showFavorited) ä½¿ç”¨å°±å¥½äº†


### @ObservedObject

@ObservedObject çš„ç”¨å¤„å’Œ @State éå¸¸ç›¸ä¼¼ï¼Œä»åå­—çœ‹æ¥å®ƒæ˜¯æ¥ä¿®é¥°ä¸€ä¸ªå¯¹è±¡çš„ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥ç»™å¤šä¸ªç‹¬ç«‹çš„ View ä½¿ç”¨ã€‚å¦‚æœä½ ç”¨ @ObservedObject æ¥ä¿®é¥°ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆé‚£ä¸ªå¯¹è±¡å¿…é¡»è¦å®ç° ObservableObject åè®®ï¼Œç„¶åç”¨ @Published ä¿®é¥°å¯¹è±¡é‡Œå±æ€§ï¼Œè¡¨ç¤ºè¿™ä¸ªå±æ€§æ˜¯éœ€è¦è¢« SwiftUI ç›‘å¬çš„

```swift
import SwiftUI

// æ­¤å¯¹è±¡å‡†å¤‡è¢«@ObservedObjectä¿®é¥°ï¼Œå› æ­¤éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š
// 1. ç»§æ‰¿äºObservableObject
// 2. éœ€è¦è¢«SwiftUIç›‘å¬çš„å±æ€§è¦ç”¨@Publishedä¿®é¥°
final class Player: ObservableObject {
    @Published private(set) var isPlaying: Bool = false
    func play() {
        isPlaying = true
    }
    func pause() {
        isPlaying = false
    }
}

struct LandmarkList: View {
    @ObservedObject var player: Player = Player()
    
    var body: some View {
        VStack {
            Button(action: {
                if self.player.isPlaying {
                    self.player.pause()
                } else {
                    self.player.play()
                }
            }, label: {
                Text(player.isPlaying ? "Pause" : "Play")
            })
        }
    }
}
```

### @EnvironmentObject

`@EnvironmentObject`æ˜¯é’ˆå¯¹å…¨å±€ç¯å¢ƒçš„ï¼Œé€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥é¿å…åœ¨åˆå§‹ View æ—¶åˆ›å»º ObservableObject, è€Œæ˜¯ä»ç¯å¢ƒä¸­è·å– ObservableObjectï¼Œä¸è¿‡éœ€è¦è®©viewæŒ‡å®šenviromentObject:

```swift
// -- SceneDelegate.swift --
class SceneDelegate: UIResponder, UIWindowSceneDelegate {
var window: UIWindow?

func scene(_ scene: UIScene, willConnectTo session: UISceneSession, options connectionOptions: UIScene.ConnectionOptions) {
    if let windowScene = scene as? UIWindowScene {
        let window = UIWindow(windowScene: windowScene)
				window.rootViewController = UIHostingController(rootView: LandmarkList().environmentObject(Player()))
        self.window = window
        window.makeKeyAndVisible()
    }
}
```

```swift
// -- LandmarkList.swift --
final class Player : ObservableObject {
    @Published private(set) var isPlaying: Bool = false
    func play() {
        isPlaying = true
    }
    func pause() {
        isPlaying = false
    }
}

struct LandmarkList: View {
    @EnvironmentObject var player: Player
    
    var body: some View {
        VStack {
            Button(action: {
                if self.player.isPlaying {
                    self.player.pause()
                } else {
                    self.player.play()
                }
            }, label: {
                Text(player.isPlaying ? "Pause" : "Play")
            })
        }
    }
}
```

å¯ä»¥çœ‹å‡ºæˆ‘ä»¬è·å– Player è¿™ä¸ª ObservableObject æ˜¯é€šè¿‡ @EnvironmentObject ä¿®é¥°å™¨ï¼Œä½†æ˜¯åœ¨å…¥å£éœ€è¦ä¼ å…¥ .environmentObject(player) ã€‚@EnvironmentObject çš„å·¥ä½œæ–¹å¼æ˜¯åœ¨ Environment æŸ¥æ‰¾ Player å®ä¾‹ã€‚

### @Environment

 SwiftUI æœ¬èº«æœ‰å¾ˆå¤šç³»ç»Ÿçº§åˆ«çš„è®¾å®šï¼Œæˆ‘ä»¬å¼€ä¸€ä¸ªé€šè¿‡ @Environment æ¥è·å–åˆ°å®ƒä»¬

 ```swift
 struct LandmarkList: View {
    @Environment(\.calendar) var calendar: Calendar
    @Environment(\.colorScheme) var colorScheme: ColorScheme
    @Environment(\.locale) var locale: Locale
    
    var body: some View {
        VStack {
            // en_CN
            Text(locale.identifier)
        }
    }
}
 ```

é€šè¿‡ @Environment ä¿®é¥°çš„å±æ€§ï¼Œæˆ‘ä»¬å¼€ä¸€ä¸ªç›‘å¬ç³»ç»Ÿçº§åˆ«ä¿¡æ¯çš„å˜æ¢ï¼Œè¿™ä¸ªä¾‹å­é‡Œä¸€æ—¦ Calendar, Locale, ColorScheme å‘ç”Ÿäº†å˜æ¢ï¼Œæˆ‘ä»¬å®šä¹‰çš„ CalendarView å°±ä¼šåˆ·æ–°


