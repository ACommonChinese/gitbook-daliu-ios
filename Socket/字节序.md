# å­—èŠ‚åº

å­—èŠ‚åºé—®é¢˜ï¼Œå³å¤§å°ç«¯é—®é¢˜ã€‚è¿™æ˜¯ç”±ä¸åŒçš„CPUæ¶æ„å¯¼è‡´ã€‚

å‡è®¾åœ¨ 0x20 å·å¼€å§‹çš„åœ°å€ä¸­ä¿å­˜ 4 å­—èŠ‚ int å‹æ•°æ® 0x12345678ï¼Œå¯¹äºå¤§ç«¯åºï¼Œæœ€é«˜ä½å­—èŠ‚ 0x12 å­˜æ”¾åˆ°ä½ä½åœ°å€ï¼Œæœ€ä½ä½å­—èŠ‚ 0x78 å­˜æ”¾åˆ°é«˜ä½åœ°å€, å¦‚å›¾æ‰€ç¤ºï¼š
![](images/9.jpg)

å°ç«¯åºçš„ä¿å­˜æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
![](images/10.jpg)

ä¸åŒ CPU ä¿å­˜å’Œè§£ææ•°æ®çš„æ–¹å¼ä¸åŒï¼ˆä¸»æµçš„ Intel ç³»åˆ— CPU ä¸ºå°ç«¯åºï¼‰ï¼Œå°ç«¯åºç³»ç»Ÿå’Œå¤§ç«¯åºç³»ç»Ÿé€šä¿¡æ—¶ä¼šå‘ç”Ÿæ•°æ®è§£æé”™è¯¯ã€‚å› æ­¤åœ¨å‘é€æ•°æ®å‰ï¼Œè¦å°†æ•°æ®è½¬æ¢ä¸ºç»Ÿä¸€çš„æ ¼å¼â€”â€”ç½‘ç»œå­—èŠ‚åºï¼ˆNetwork Byte Orderï¼‰ã€‚ç½‘ç»œå­—èŠ‚åºç»Ÿä¸€ä¸ºå¤§ç«¯åºã€‚

ä¸»æœº A å…ˆæŠŠæ•°æ®è½¬æ¢æˆå¤§ç«¯åºå†è¿›è¡Œç½‘ç»œä¼ è¾“ï¼Œä¸»æœº B æ”¶åˆ°æ•°æ®åå…ˆè½¬æ¢ä¸ºè‡ªå·±çš„æ ¼å¼å†è§£æã€‚

htons() ç”¨æ¥å°†å½“å‰ä¸»æœºå­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºï¼Œå…¶ä¸­hä»£è¡¨ä¸»æœºï¼ˆhostï¼‰å­—èŠ‚åºï¼Œnä»£è¡¨ç½‘ç»œï¼ˆnetworkï¼‰å­—èŠ‚åºï¼Œsä»£è¡¨shortï¼Œhtons æ˜¯ hã€toã€nã€s çš„ç»„åˆï¼Œå¯ä»¥ç†è§£ä¸ºâ€å°† short å‹æ•°æ®ä»å½“å‰ä¸»æœºå­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºâ€œã€‚

å¸¸è§çš„ç½‘ç»œå­—èŠ‚è½¬æ¢å‡½æ•°æœ‰ï¼š
htons()ï¼šhost to network shortï¼Œå°† short ç±»å‹æ•°æ®ä»ä¸»æœºå­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºã€‚
ntohs()ï¼šnetwork to host shortï¼Œå°† short ç±»å‹æ•°æ®ä»ç½‘ç»œå­—èŠ‚åºè½¬æ¢ä¸ºä¸»æœºå­—èŠ‚åºã€‚
htonl()ï¼šhost to network longï¼Œå°† long ç±»å‹æ•°æ®ä»ä¸»æœºå­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºã€‚
ntohl()ï¼šnetwork to host longï¼Œå°† long ç±»å‹æ•°æ®ä»ç½‘ç»œå­—èŠ‚åºè½¬æ¢ä¸ºä¸»æœºå­—èŠ‚åºã€‚

é€šå¸¸ï¼Œä»¥sä¸ºåç¼€çš„å‡½æ•°ä¸­ï¼Œsä»£è¡¨ 2 ä¸ªå­—èŠ‚ shortï¼Œå› æ­¤ç”¨äºç«¯å£å·è½¬æ¢ï¼›ä»¥lä¸ºåç¼€çš„å‡½æ•°ä¸­ï¼Œlä»£è¡¨ 4 ä¸ªå­—èŠ‚çš„ longï¼Œå› æ­¤ç”¨äº IP åœ°å€è½¬æ¢ã€‚

ç¤ºä¾‹ï¼š

```C
#include <stdio.h>

int main(int argc, const char * argv[]) {
    unsigned short host_port = 0x1234, net_port;
    unsigned long host_addr = 0x12345678, net_addr;
    net_port = htons(host_port); // ä¸»æœºç«¯å£å·è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åº
    net_addr = htonl(host_addr); // IPåœ°å€è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åº
    printf("ğŸ‘¤ port: %#x\n", host_port);
    printf("ğŸŒ port: %#x\n", net_port);
    printf("ğŸ‘¤ address: %#lx\n", host_addr);
    printf("ğŸŒ address: %#lx\n", net_addr);
    return 0;
}
```
ğŸ‘¤ port: 0x1234
ğŸŒ port: 0x3412
ğŸ‘¤ address: 0x12345678
ğŸŒ address: 0x78563412


å†æ¥çœ‹ä¸€ä¸ªå‡½æ•°ï¼š`inet_addr`
serv_addr.sin_addr.s_addr = inet_addr("127.0.0.1");  //å…·ä½“çš„IPåœ°å€
inet_addr() é™¤äº†å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º 32 ä½æ•´æ•°ï¼ŒåŒæ—¶è¿˜è¿›è¡Œç½‘ç»œå­—èŠ‚åºè½¬æ¢ï¼Œç¤ºä¾‹ï¼š

```C

#include <iostream>
#include <sys/socket.h>
#include <arpa/inet.h>

#pragma comment(lib, "ws2_32.lib")
int main(){
    char *addr1 = "1.2.3.4";
    char *addr2 = "1.2.3.256";
    unsigned long conv_addr = inet_addr(addr1);
    if(conv_addr == INADDR_NONE){
        puts("Error occured!");
    }else{
        printf("Network ordered integer addr: %#lx\n", conv_addr);
    }
    conv_addr = inet_addr(addr2);
    if(conv_addr == INADDR_NONE){
        puts("Error occured!");
    }else{
        printf("Network ordered integer addr: %#lx\n", conv_addr);
    }
    system("pause");
    return 0;
}
```
Network ordered integer addr: 0x4030201
Error occured!

ä»è¿è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œinet_addr() ä¸ä»…å¯ä»¥æŠŠ IP åœ°å€è½¬æ¢ä¸º 32 ä½æ•´æ•°ï¼Œè¿˜å¯ä»¥æ£€æµ‹æ— æ•ˆ IP åœ°å€ã€‚

æ³¨æ„ï¼šä¸º sockaddr_in æˆå‘˜èµ‹å€¼æ—¶éœ€è¦æ˜¾å¼åœ°å°†ä¸»æœºå­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºï¼Œè€Œé€šè¿‡ write()/send() å‘é€æ•°æ®æ—¶ TCP åè®®ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºï¼Œä¸éœ€è¦å†è°ƒç”¨ç›¸åº”çš„å‡½æ•°ã€‚
